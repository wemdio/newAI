# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∫—Å–∏ –¥–ª—è Telegram –∞–∫–∫–∞—É–Ω—Ç–æ–≤

## –û–ø–∏—Å–∞–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø—Ä–æ–∫—Å–∏ –ø–µ—Ä–µ–¥ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º Telegram –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏.

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### Backend (Python Service)

#### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∫—Å–∏ (`telethon_client.py`)

–ü–µ—Ä–µ–¥ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∞–∫–∫–∞—É–Ω—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø—Ä–æ–∫—Å–∏:

```python
async def _check_proxy(self, proxy_dict: Dict) -> bool:
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ –∫ —Å–µ—Ä–≤–µ—Ä–∞–º Telegram
    
    - –ï—Å–ª–∏ –ø—Ä–æ–∫—Å–∏ –Ω–µ —É–∫–∞–∑–∞–Ω - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç True (–ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)
    - –ï—Å–ª–∏ –ø—Ä–æ–∫—Å–∏ —É–∫–∞–∑–∞–Ω - —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ DC1 Telegram (149.154.175.53:443)
    - –ü–æ–¥–¥–µ—Ä–∂–∫–∞: SOCKS5, SOCKS4, HTTP –ø—Ä–æ–∫—Å–∏
    - Timeout: 10 —Å–µ–∫—É–Ω–¥
    """
```

#### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–ï—Å–ª–∏ –ø—Ä–æ–∫—Å–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –ê–∫–∫–∞—É–Ω—Ç –ù–ï –±—É–¥–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
- –°—Ç–∞—Ç—É—Å –∞–∫–∫–∞—É–Ω—Ç–∞ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `error` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- `is_available` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ `false`
- –í –ª–æ–≥–∞—Ö –≤—ã–≤–æ–¥–∏—Ç—Å—è –ø—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–∫–∏

#### 3. –õ–æ–≥–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```python
# Parse proxy if provided
proxy = self._parse_proxy(account.get('proxy_url'))

# Check proxy connection if proxy is configured
if proxy:
    proxy_works = await self._check_proxy(proxy)
    if not proxy_works:
        print(f"‚ùå Proxy verification failed")
        # Mark account as error in database
        await self.supabase.mark_account_error(
            account_id,
            f"Proxy connection failed: {proxy_url}"
        )
        return False

# Create client (only if proxy check passed or no proxy)
client = TelegramClient(session_file, api_id, api_hash, proxy=proxy)
```

### Frontend

#### 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ —Å –ø—Ä–æ–∫—Å–∏

–ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ session string –µ—Å—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ **Proxy URL**:

```
–§–æ—Ä–º–∞—Ç: protocol://username:password@host:port

–ü—Ä–∏–º–µ—Ä—ã:
- socks5://user:pass@1.2.3.4:1080
- socks5://proxy.example.com:1080
- http://10.0.0.1:8080
```

#### 2. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∫—Å–∏

–î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤:
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ –∞–∫–∫–∞—É–Ω—Ç–∞
2. –ò–∑–º–µ–Ω–∏—Ç–µ –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ Proxy URL
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. **–í–∞–∂–Ω–æ:** –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Python Worker –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

#### 3. –°—Ç–∞—Ç—É—Å—ã –∞–∫–∫–∞—É–Ω—Ç–æ–≤

- **–ê–∫—Ç–∏–≤–µ–Ω** - –∞–∫–∫–∞—É–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- **–ü–∞—É–∑–∞** - –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω (flood wait)
- **–ó–∞–±–∞–Ω–µ–Ω** - –∞–∫–∫–∞—É–Ω—Ç –∑–∞–±–∞–Ω–µ–Ω –≤ Telegram
- **–û—à–∏–±–∫–∞** - –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–∫—Å–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –ø—Ä–æ–∫—Å–∏

- **SOCKS5** - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è (–ª—É—á—à–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
- **SOCKS4** - –±–∞–∑–æ–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- **HTTP/HTTPS** - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `PySocks` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–∫—Å–∏:

```txt
pysocks==1.7.1
```

## API Endpoints

### POST `/api/messaging/accounts/import-session`

–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `proxy_url`:

```json
{
  "account_name": "My Account",
  "session_string": "838bbfe1808a...",
  "proxy_url": "socks5://user:pass@1.2.3.4:1080"  // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
}
```

### PUT `/api/messaging/accounts/:id`

–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∫—Å–∏ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞:

```json
{
  "proxy_url": "socks5://user:pass@1.2.3.4:1080"  // –∏–ª–∏ null –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
}
```

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –ø—Ä–æ–∫—Å–∏

–ï—Å–ª–∏ –ø–æ–ª–µ `proxy_url` –ø—É—Å—Ç–æ–µ –∏–ª–∏ `null`, –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è - –∞–∫–∫–∞—É–Ω—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é.

### 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Python Worker

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–∫—Å–∏ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Python Worker:

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π worker (Ctrl+C)
# –ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–Ω–æ–≤–∞:
cd backend/python-service
python main.py
```

### 3. –í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏

–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∫—Å–∏ –∑–∞–Ω–∏–º–∞–µ—Ç –¥–æ 10 —Å–µ–∫—É–Ω–¥ (timeout). –ï—Å–ª–∏ –ø—Ä–æ–∫—Å–∏ –º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è.

### 4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–∫—Å–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å Python Worker:

```
üîç Testing proxy connection: 1.2.3.4:1080
‚úÖ Proxy connection successful
```

–ò–ª–∏ –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏:

```
üîç Testing proxy connection: 1.2.3.4:1080
‚ùå Proxy connection failed: Connection refused
‚ö†Ô∏è Marking account xxx as error: Proxy connection failed
```

## Troubleshooting

### –ê–∫–∫–∞—É–Ω—Ç –≤ —Å—Ç–∞—Ç—É—Å–µ "–û—à–∏–±–∫–∞"

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç–∞ proxy URL
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø—Ä–æ–∫—Å–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (ping, telnet)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–∫—Å–∏ (username/password)
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –ø—Ä–æ–∫—Å–∏
5. –ò–ª–∏ —É–¥–∞–ª–∏—Ç–µ –ø—Ä–æ–∫—Å–∏ –∏ –ø–æ–¥–∫–ª—é—á–∞–π—Ç–µ—Å—å –Ω–∞–ø—Ä—è–º—É—é (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)

### –ü—Ä–æ–∫—Å–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç

1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø—Ä–æ–∫—Å–∏ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Telegram (149.154.175.53:443)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
3. –£–≤–µ–ª–∏—á—å—Ç–µ timeout –≤ –∫–æ–¥–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10 —Å–µ–∫)

### –ò–∑–º–µ–Ω–∏–ª –ø—Ä–æ–∫—Å–∏, –Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Python Worker - –æ–Ω —á–∏—Ç–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏.

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ü—Ä–æ–∫—Å–∏ URL —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ (–≤–∫–ª—é—á–∞—è –ø–∞—Ä–æ–ª—å)
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–æ–∫—Å–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø—Ä–æ–∫—Å–∏ –¥–ª—è –≤–∞–∂–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤

## –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

–í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –≤ –±—É–¥—É—â–µ–º:

1. –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∫—Å–∏ (–∫–∞–∂–¥—ã–µ N —á–∞—Å–æ–≤)
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –ø—Ä–æ–∫—Å–∏
3. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–∫—Å–∏ (—Å–∫–æ—Ä–æ—Å—Ç—å, uptime)
4. –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∫—Å–∏ credentials –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
5. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–∫—Å–∏ –ø—É–ª–æ–≤ (—Ä–æ—Ç–∞—Ü–∏—è –ø—Ä–æ–∫—Å–∏)

